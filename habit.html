<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Discipline | Habit Tracker with History</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4CAF50;
            --warning: #ff9800;
            --danger: #f44336;
            --card-bg: #ffffff;
            --shadow: rgba(0, 0, 0, 0.1);
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        body {
            background-color: #f0f2f5;
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--secondary);
            font-size: 2.8rem;
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
        }

        h1:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 4px;
            background: linear-gradient(to right, var(--accent), var(--primary));
            border-radius: 2px;
        }

        .tagline {
            color: #666;
            font-size: 1.2rem;
            margin-top: 15px;
        }

        .date-display {
            margin-top: 15px;
            font-size: 1.1rem;
            color: var(--gray);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .date-display i {
            color: var(--primary);
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1100px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px var(--shadow);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.5rem;
        }

        .card-title i {
            margin-right: 10px;
            background-color: rgba(67, 97, 238, 0.1);
            padding: 10px;
            border-radius: 50%;
        }

        .quote-container {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .quote-content {
            font-size: 1.5rem;
            font-style: italic;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .quote-author {
            text-align: right;
            font-weight: 600;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .new-quote-btn {
            background-color: white;
            color: var(--primary);
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            align-self: flex-start;
            transition: all 0.3s ease;
        }

        .new-quote-btn:hover {
            background-color: #f0f0f0;
            transform: translateX(5px);
        }

        .habit-form {
            display: flex;
            margin-bottom: 25px;
        }

        .habit-input {
            flex-grow: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px 0 0 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .habit-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .add-habit-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 0 10px 10px 0;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .add-habit-btn:hover {
            background-color: var(--secondary);
        }

        .habits-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .habit-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
            border-radius: 10px;
            border-left: 5px solid var(--primary);
            transition: all 0.3s ease;
        }

        .habit-item:hover {
            background-color: #f0f0f0;
        }

        .habit-name {
            flex-grow: 1;
            font-size: 1.1rem;
        }

        .habit-actions {
            display: flex;
            gap: 10px;
        }

        .habit-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: var(--success);
        }

        .delete-habit {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.2s;
        }

        .delete-habit:hover {
            transform: scale(1.2);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            text-align: center;
            padding: 25px 15px;
            border-radius: 15px;
            color: white;
        }

        .stat-card:nth-child(1) {
            background: linear-gradient(to right, #4CAF50, #2E7D32);
        }

        .stat-card:nth-child(2) {
            background: linear-gradient(to right, #2196F3, #0D47A1);
        }

        .stat-card:nth-child(3) {
            background: linear-gradient(to right, #FF9800, #EF6C00);
        }

        .stat-card:nth-child(4) {
            background: linear-gradient(to right, #9C27B0, #6A1B9A);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .completed {
            text-decoration: line-through;
            opacity: 0.7;
            border-left-color: var(--success) !important;
        }

        /* History Section */
        .history-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        @media (max-width: 1100px) {
            .history-container {
                grid-template-columns: 1fr;
            }
        }

        .calendar-container {
            margin-bottom: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            background-color: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .calendar-nav button:hover {
            background-color: var(--secondary);
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 15px;
        }

        .calendar-day {
            text-align: center;
            padding: 10px 5px;
            border-radius: 8px;
            font-weight: 600;
            color: var(--gray);
            background-color: var(--light-gray);
        }

        .calendar-date {
            text-align: center;
            padding: 12px 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .calendar-date:hover {
            background-color: #e0e0e0;
        }

        .calendar-date.today {
            background-color: var(--primary);
            color: white;
        }

        .calendar-date.has-habits::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: var(--success);
        }

        .calendar-date.completed-day::after {
            background-color: var(--success);
        }

        .calendar-date.partial-day::after {
            background-color: var(--warning);
        }

        .calendar-date.empty-day::after {
            background-color: var(--gray);
        }

        .history-habits {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-day {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }

        .history-day:last-child {
            border-bottom: none;
        }

        .history-date {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-completion {
            font-size: 0.9rem;
            background-color: var(--light-gray);
            padding: 3px 10px;
            border-radius: 20px;
        }

        .history-habit-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }

        .history-habit-status {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .history-habit-status.completed {
            color: var(--success);
        }

        .history-habit-status.not-completed {
            color: var(--danger);
        }

        .progress-bar-container {
            margin: 20px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .progress-bar {
            height: 12px;
            background-color: var(--light-gray);
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--accent));
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ccc;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            color: #777;
            border-top: 1px solid #ddd;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid var(--light-gray);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 25px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Daily Discipline</h1>
            <p class="tagline">Build habits, stay motivated, transform your life one day at a time</p>
            <div class="date-display">
                <i class="fas fa-calendar-alt"></i>
                <span id="current-date">Loading...</span>
            </div>
        </header>

        <div class="stats-container">
            <div class="stat-card">
                <i class="fas fa-check-circle fa-2x"></i>
                <div class="stat-value" id="completed-count">0</div>
                <div class="stat-label">Completed Today</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-bullseye fa-2x"></i>
                <div class="stat-value" id="total-count">0</div>
                <div class="stat-label">Total Habits</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-fire fa-2x"></i>
                <div class="stat-value" id="streak-count">0</div>
                <div class="stat-label">Day Streak</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-chart-line fa-2x"></i>
                <div class="stat-value" id="weekly-average">0%</div>
                <div class="stat-label">Weekly Average</div>
            </div>
        </div>

        <div class="app-container">
            <div class="card quote-container">
                <div class="card-title">
                    <i class="fas fa-quote-left"></i>
                    <h2>Daily Motivation</h2>
                </div>
                <div class="quote-content" id="quote-text">
                    The secret of getting ahead is getting started.
                </div>
                <div class="quote-author" id="quote-author">— Mark Twain</div>
                <button class="new-quote-btn" id="new-quote">
                    <i class="fas fa-sync-alt"></i> New Quote
                </button>
            </div>

            <div class="card">
                <div class="tabs">
                    <div class="tab active" data-tab="today">Today's Habits</div>
                    <div class="tab" data-tab="all">All Habits</div>
                </div>
                
                <div class="tab-content active" id="today-tab">
                    <form class="habit-form" id="habit-form">
                        <input type="text" class="habit-input" id="habit-input" placeholder="Add a new habit (e.g., Exercise for 30 mins)" required>
                        <button type="submit" class="add-habit-btn">Add</button>
                    </form>
                    
                    <ul class="habits-list" id="habits-list">
                        <!-- Today's habits will be added here dynamically -->
                    </ul>
                    
                    <div id="today-empty-state" class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>No habits for today</h3>
                        <p>Add your first habit above to get started on your journey!</p>
                    </div>

                    <div class="progress-bar-container">
                        <div class="progress-label">
                            <span>Today's Progress</span>
                            <span id="today-progress-percent">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="today-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="all-tab">
                    <div id="all-habits-list">
                        <!-- All habits will be added here dynamically -->
                    </div>
                    <div id="all-empty-state" class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>No habits yet</h3>
                        <p>Add your first habit to get started on your journey!</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="history-container">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-history"></i>
                    <h2>Habit History</h2>
                </div>
                
                <div class="calendar-container">
                    <div class="calendar-header">
                        <h3 id="current-month-year">July 2023</h3>
                        <div class="calendar-nav">
                            <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
                            <button id="today-month">Today</button>
                            <button id="next-month"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                    
                    <div class="calendar" id="calendar">
                        <!-- Calendar will be generated dynamically -->
                    </div>
                </div>
                
                <div id="selected-date-habits" class="history-habits">
                    <!-- Selected date habits will be shown here -->
                </div>
            </div>
            
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-chart-bar"></i>
                    <h2>Weekly Progress</h2>
                </div>
                
                <div id="weekly-progress">
                    <!-- Weekly progress will be shown here -->
                </div>
                
                <div class="progress-bar-container">
                    <div class="progress-label">
                        <span>Overall Completion Rate</span>
                        <span id="overall-progress-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="overall-progress-bar" style="width: 0%"></div>
                    </div>
                </div>
                
                <div id="yesterday-summary" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px; color: var(--primary);">
                        <i class="fas fa-arrow-left"></i> Yesterday's Summary
                    </h3>
                    <!-- Yesterday's summary will be shown here -->
                </div>
            </div>
        </div>

        <footer>
            <p>Daily Discipline Habit Tracker &copy; <span id="current-year">2023</span> | Stay consistent, stay motivated!</p>
        </footer>
    </div>

    <script>
        // Motivational quotes database
        const quotes = [
            {
                text: "The secret of getting ahead is getting started.",
                author: "Mark Twain"
            },
            {
                text: "We are what we repeatedly do. Excellence, then, is not an act, but a habit.",
                author: "Aristotle"
            },
            {
                text: "The only way to do great work is to love what you do.",
                author: "Steve Jobs"
            },
            {
                text: "Discipline is choosing between what you want now and what you want most.",
                author: "Abraham Lincoln"
            },
            {
                text: "Your future is created by what you do today, not tomorrow.",
                author: "Robert Kiyosaki"
            },
            {
                text: "Small daily improvements are the key to staggering long-term results.",
                author: "John C. Maxwell"
            },
            {
                text: "Motivation is what gets you started. Habit is what keeps you going.",
                author: "Jim Ryun"
            },
            {
                text: "The way to get started is to quit talking and begin doing.",
                author: "Walt Disney"
            },
            {
                text: "Success is not final, failure is not fatal: it is the courage to continue that counts.",
                author: "Winston Churchill"
            },
            {
                text: "The best time to plant a tree was 20 years ago. The second best time is now.",
                author: "Chinese Proverb"
            },
            {
                text: "Don't watch the clock; do what it does. Keep going.",
                author: "Sam Levenson"
            },
            {
                text: "The only limit to our realization of tomorrow will be our doubts of today.",
                author: "Franklin D. Roosevelt"
            }
        ];

        // Get DOM elements
        const quoteText = document.getElementById('quote-text');
        const quoteAuthor = document.getElementById('quote-author');
        const newQuoteBtn = document.getElementById('new-quote');
        const habitForm = document.getElementById('habit-form');
        const habitInput = document.getElementById('habit-input');
        const habitsList = document.getElementById('habits-list');
        const allHabitsList = document.getElementById('all-habits-list');
        const todayEmptyState = document.getElementById('today-empty-state');
        const allEmptyState = document.getElementById('all-empty-state');
        const completedCount = document.getElementById('completed-count');
        const totalCount = document.getElementById('total-count');
        const streakCount = document.getElementById('streak-count');
        const weeklyAverage = document.getElementById('weekly-average');
        const currentDateElement = document.getElementById('current-date');
        const currentYear = document.getElementById('current-year');
        const todayProgressPercent = document.getElementById('today-progress-percent');
        const todayProgressBar = document.getElementById('today-progress-bar');
        const overallProgressPercent = document.getElementById('overall-progress-percent');
        const overallProgressBar = document.getElementById('overall-progress-bar');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const calendar = document.getElementById('calendar');
        const currentMonthYear = document.getElementById('current-month-year');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const todayMonthBtn = document.getElementById('today-month');
        const selectedDateHabits = document.getElementById('selected-date-habits');
        const weeklyProgress = document.getElementById('weekly-progress');
        const yesterdaySummary = document.getElementById('yesterday-summary');

        // Set current date
        const now = new Date();
        currentDateElement.textContent = now.toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        currentYear.textContent = now.getFullYear();

        // Initialize habits from localStorage or empty array
        let habits = JSON.parse(localStorage.getItem('habits')) || [];
        let streak = parseInt(localStorage.getItem('streak')) || 0;
        let lastVisitDate = localStorage.getItem('lastVisitDate');
        let currentMonth = now.getMonth();
        let currentYearCalendar = now.getFullYear();
        
        // Check for streak continuation
        checkStreakContinuation();
        
        // Display initial quote
        displayRandomQuote();
        
        // Display habits on load
        renderTodayHabits();
        renderAllHabits();
        updateStats();
        generateCalendar(currentMonth, currentYearCalendar);
        renderSelectedDateHabits(now);
        renderWeeklyProgress();
        renderYesterdaySummary();
        
        // Event listeners
        newQuoteBtn.addEventListener('click', displayRandomQuote);
        habitForm.addEventListener('submit', addHabit);
        
        // Tab switching
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show corresponding content
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                    }
                });
            });
        });
        
        // Calendar navigation
        prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYearCalendar--;
            }
            generateCalendar(currentMonth, currentYearCalendar);
        });
        
        nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYearCalendar++;
            }
            generateCalendar(currentMonth, currentYearCalendar);
        });
        
        todayMonthBtn.addEventListener('click', () => {
            currentMonth = now.getMonth();
            currentYearCalendar = now.getFullYear();
            generateCalendar(currentMonth, currentYearCalendar);
        });
        
        // Display a random motivational quote
        function displayRandomQuote() {
            const randomIndex = Math.floor(Math.random() * quotes.length);
            const randomQuote = quotes[randomIndex];
            
            quoteText.textContent = randomQuote.text;
            quoteAuthor.textContent = `— ${randomQuote.author}`;
        }
        
        // Add a new habit
        function addHabit(e) {
            e.preventDefault();
            
            const habitName = habitInput.value.trim();
            if (!habitName) return;
            
            const today = getTodayDateString();
            
            const newHabit = {
                id: Date.now(),
                name: habitName,
                completed: false,
                date: today,
                createdAt: new Date().toISOString()
            };
            
            habits.push(newHabit);
            saveHabits();
            renderTodayHabits();
            renderAllHabits();
            updateStats();
            generateCalendar(currentMonth, currentYearCalendar);
            renderSelectedDateHabits(new Date());
            
            // Clear input
            habitInput.value = '';
            habitInput.focus();
        }
        
        // Toggle habit completion
        function toggleHabit(id) {
            habits = habits.map(habit => {
                if (habit.id === id) {
                    return { ...habit, completed: !habit.completed };
                }
                return habit;
            });
            
            saveHabits();
            renderTodayHabits();
            renderAllHabits();
            updateStats();
            generateCalendar(currentMonth, currentYearCalendar);
            renderSelectedDateHabits(new Date());
        }
        
        // Delete a habit
        function deleteHabit(id) {
            habits = habits.filter(habit => habit.id !== id);
            saveHabits();
            renderTodayHabits();
            renderAllHabits();
            updateStats();
            generateCalendar(currentMonth, currentYearCalendar);
            renderSelectedDateHabits(new Date());
        }
        
        // Render today's habits
        function renderTodayHabits() {
            const today = getTodayDateString();
            const todayHabits = habits.filter(habit => habit.date === today);
            
            if (todayHabits.length === 0) {
                habitsList.style.display = 'none';
                todayEmptyState.style.display = 'block';
                
                // Update progress bar
                todayProgressPercent.textContent = '0%';
                todayProgressBar.style.width = '0%';
                return;
            }
            
            habitsList.style.display = 'block';
            todayEmptyState.style.display = 'none';
            
            // Calculate completion percentage
            const completedToday = todayHabits.filter(habit => habit.completed).length;
            const completionPercentage = Math.round((completedToday / todayHabits.length) * 100);
            
            // Update progress bar
            todayProgressPercent.textContent = `${completionPercentage}%`;
            todayProgressBar.style.width = `${completionPercentage}%`;
            
            // Display today's habits
            habitsList.innerHTML = todayHabits.map(habit => `
                <li class="habit-item ${habit.completed ? 'completed' : ''}" data-id="${habit.id}">
                    <span class="habit-name">${habit.name}</span>
                    <div class="habit-actions">
                        <input type="checkbox" class="habit-checkbox" ${habit.completed ? 'checked' : ''}>
                        <button class="delete-habit" title="Delete habit">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </li>
            `).join('');
            
            // Add event listeners to checkboxes and delete buttons
            document.querySelectorAll('.habit-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const habitId = parseInt(this.closest('.habit-item').dataset.id);
                    toggleHabit(habitId);
                });
            });
            
            document.querySelectorAll('.delete-habit').forEach(button => {
                button.addEventListener('click', function() {
                    const habitId = parseInt(this.closest('.habit-item').dataset.id);
                    deleteHabit(habitId);
                });
            });
        }
        
        // Render all habits
        function renderAllHabits() {
            if (habits.length === 0) {
                allHabitsList.innerHTML = '';
                allEmptyState.style.display = 'block';
                return;
            }
            
            allEmptyState.style.display = 'none';
            
            // Group habits by date
            const habitsByDate = {};
            habits.forEach(habit => {
                if (!habitsByDate[habit.date]) {
                    habitsByDate[habit.date] = [];
                }
                habitsByDate[habit.date].push(habit);
            });
            
            // Sort dates in descending order (newest first)
            const sortedDates = Object.keys(habitsByDate).sort((a, b) => {
                return new Date(b) - new Date(a);
            });
            
            // Display all habits grouped by date
            allHabitsList.innerHTML = sortedDates.map(date => {
                const dateHabits = habitsByDate[date];
                const completedCount = dateHabits.filter(h => h.completed).length;
                const totalCount = dateHabits.length;
                const completionPercentage = Math.round((completedCount / totalCount) * 100);
                const dateObj = new Date(date);
                const formattedDate = dateObj.toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric',
                    year: dateObj.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
                });
                
                return `
                    <div class="history-day">
                        <div class="history-date">
                            <span>${formattedDate}</span>
                            <span class="history-completion">${completedCount}/${totalCount} (${completionPercentage}%)</span>
                        </div>
                        ${dateHabits.map(habit => `
                            <div class="history-habit-item">
                                <div class="history-habit-status ${habit.completed ? 'completed' : 'not-completed'}">
                                    <i class="fas fa-${habit.completed ? 'check-circle' : 'times-circle'}"></i>
                                </div>
                                <span>${habit.name}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('');
        }
        
        // Update statistics
        function updateStats() {
            const today = getTodayDateString();
            const todayHabits = habits.filter(habit => habit.date === today);
            const completedToday = todayHabits.filter(habit => habit.completed).length;
            
            completedCount.textContent = completedToday;
            totalCount.textContent = todayHabits.length;
            
            // Calculate weekly average
            const weeklyAvg = calculateWeeklyAverage();
            weeklyAverage.textContent = `${weeklyAvg}%`;
            
            // Calculate overall completion rate
            const overallCompletion = calculateOverallCompletion();
            overallProgressPercent.textContent = `${overallCompletion}%`;
            overallProgressBar.style.width = `${overallCompletion}%`;
            
            // Update streak display
            streakCount.textContent = streak;
        }
        
        // Calculate weekly average completion
        function calculateWeeklyAverage() {
            const last7Days = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push(getDateString(date));
            }
            
            let totalCompletion = 0;
            let daysWithHabits = 0;
            
            last7Days.forEach(date => {
                const dateHabits = habits.filter(habit => habit.date === date);
                if (dateHabits.length > 0) {
                    const completed = dateHabits.filter(habit => habit.completed).length;
                    const completionPercentage = Math.round((completed / dateHabits.length) * 100);
                    totalCompletion += completionPercentage;
                    daysWithHabits++;
                }
            });
            
            return daysWithHabits > 0 ? Math.round(totalCompletion / daysWithHabits) : 0;
        }
        
        // Calculate overall completion rate
        function calculateOverallCompletion() {
            if (habits.length === 0) return 0;
            
            const completedHabits = habits.filter(habit => habit.completed).length;
            return Math.round((completedHabits / habits.length) * 100);
        }
        
        // Check and update streak
        function checkStreakContinuation() {
            const today = getTodayDateString();
            
            if (!lastVisitDate) {
                // First visit
                localStorage.setItem('lastVisitDate', today);
                return;
            }
            
            const lastVisit = new Date(lastVisitDate);
            const currentDate = new Date(today);
            const diffTime = Math.abs(currentDate - lastVisit);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // Check if user completed habits yesterday
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = getDateString(yesterday);
            const yesterdayHabits = habits.filter(habit => habit.date === yesterdayStr);
            const allCompletedYesterday = yesterdayHabits.length > 0 && 
                                         yesterdayHabits.every(habit => habit.completed);
            
            if (diffDays === 1 && allCompletedYesterday) {
                // User visited yesterday and completed all habits, continue streak
                streak++;
            } else if (diffDays > 1) {
                // Streak broken
                streak = 1;
            } else if (diffDays === 0) {
                // Same day, don't change streak
            } else {
                streak = 1;
            }
            
            localStorage.setItem('streak', streak);
            localStorage.setItem('lastVisitDate', today);
        }
        
        // Generate calendar
        function generateCalendar(month, year) {
            // Update month/year display
            const monthNames = ["January", "February", "March", "April", "May", "June",
                               "July", "August", "September", "October", "November", "December"];
            currentMonthYear.textContent = `${monthNames[month]} ${year}`;
            
            // Get first day of month and total days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const totalDays = lastDay.getDate();
            const firstDayIndex = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            // Clear calendar
            calendar.innerHTML = '';
            
            // Add day headers
            const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
            dayNames.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                calendar.appendChild(dayElement);
            });
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < firstDayIndex; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-date';
                calendar.appendChild(emptyCell);
            }
            
            // Add days of the month
            const today = new Date();
            const todayStr = getTodayDateString();
            
            for (let day = 1; day <= totalDays; day++) {
                const date = new Date(year, month, day);
                const dateStr = getDateString(date);
                
                const dateElement = document.createElement('div');
                dateElement.className = 'calendar-date';
                dateElement.textContent = day;
                dateElement.dataset.date = dateStr;
                
                // Check if this is today
                if (dateStr === todayStr) {
                    dateElement.classList.add('today');
                }
                
                // Check if there are habits for this date
                const dateHabits = habits.filter(habit => habit.date === dateStr);
                if (dateHabits.length > 0) {
                    dateElement.classList.add('has-habits');
                    
                    // Check completion status
                    const completed = dateHabits.filter(habit => habit.completed).length;
                    if (completed === dateHabits.length) {
                        dateElement.classList.add('completed-day');
                    } else if (completed > 0) {
                        dateElement.classList.add('partial-day');
                    } else {
                        dateElement.classList.add('empty-day');
                    }
                }
                
                // Add click event
                dateElement.addEventListener('click', () => {
                    renderSelectedDateHabits(date);
                });
                
                calendar.appendChild(dateElement);
            }
        }
        
        // Render habits for selected date
        function renderSelectedDateHabits(date) {
            const dateStr = getDateString(date);
            const dateHabits = habits.filter(habit => habit.date === dateStr);
            
            // Format date for display
            const formattedDate = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            if (dateHabits.length === 0) {
                selectedDateHabits.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-day"></i>
                        <h3>No habits for ${formattedDate}</h3>
                        <p>No habits were tracked on this day.</p>
                    </div>
                `;
                return;
            }
            
            const completedCount = dateHabits.filter(h => h.completed).length;
            const totalCount = dateHabits.length;
            const completionPercentage = Math.round((completedCount / totalCount) * 100);
            
            selectedDateHabits.innerHTML = `
                <div class="history-date">
                    <span>${formattedDate}</span>
                    <span class="history-completion">${completedCount}/${totalCount} (${completionPercentage}%)</span>
                </div>
                ${dateHabits.map(habit => `
                    <div class="history-habit-item">
                        <div class="history-habit-status ${habit.completed ? 'completed' : 'not-completed'}">
                            <i class="fas fa-${habit.completed ? 'check-circle' : 'times-circle'}"></i>
                        </div>
                        <span>${habit.name}</span>
                    </div>
                `).join('')}
            `;
        }
        
        // Render weekly progress
        function renderWeeklyProgress() {
            const last7Days = [];
            const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push({
                    date: date,
                    dateStr: getDateString(date),
                    dayName: dayNames[date.getDay()]
                });
            }
            
            weeklyProgress.innerHTML = last7Days.map(day => {
                const dateHabits = habits.filter(habit => habit.date === day.dateStr);
                const completed = dateHabits.filter(habit => habit.completed).length;
                const total = dateHabits.length;
                const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                // Check if this is today
                const isToday = getDateString(new Date()) === day.dateStr;
                
                return `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-weight: ${isToday ? '600' : '400'}; color: ${isToday ? 'var(--primary)' : 'inherit'}">
                                ${isToday ? 'Today' : day.dayName} ${day.date.getDate()}
                            </span>
                            <span style="font-weight: 600;">${percentage}%</span>
                        </div>
                        <div style="height: 8px; background-color: var(--light-gray); border-radius: 4px; overflow: hidden;">
                            <div style="height: 100%; width: ${percentage}%; background-color: ${percentage === 100 ? 'var(--success)' : percentage > 50 ? 'var(--primary)' : 'var(--warning)'}; border-radius: 4px;"></div>
                        </div>
                        <div style="font-size: 0.8rem; color: var(--gray); margin-top: 3px;">
                            ${completed}/${total} completed
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Render yesterday's summary
        function renderYesterdaySummary() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = getDateString(yesterday);
            const yesterdayHabits = habits.filter(habit => habit.date === yesterdayStr);
            
            if (yesterdayHabits.length === 0) {
                yesterdaySummary.innerHTML += `
                    <div class="empty-state" style="padding: 20px 0;">
                        <i class="fas fa-calendar-minus"></i>
                        <p>No habits tracked yesterday</p>
                    </div>
                `;
                return;
            }
            
            const completedYesterday = yesterdayHabits.filter(h => h.completed).length;
            const totalYesterday = yesterdayHabits.length;
            const yesterdayPercentage = Math.round((completedYesterday / totalYesterday) * 100);
            
            yesterdaySummary.innerHTML += `
                <div style="margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Completion Rate</span>
                        <span style="font-weight: 600;">${yesterdayPercentage}%</span>
                    </div>
                    <div style="height: 8px; background-color: var(--light-gray); border-radius: 4px; overflow: hidden;">
                        <div style="height: 100%; width: ${yesterdayPercentage}%; background-color: ${yesterdayPercentage === 100 ? 'var(--success)' : 'var(--warning)'}; border-radius: 4px;"></div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <p style="margin-bottom: 10px;"><strong>Habits from yesterday:</strong></p>
                    ${yesterdayHabits.map(habit => `
                        <div style="display: flex; align-items: center; margin-bottom: 8px;">
                            <div style="margin-right: 10px; color: ${habit.completed ? 'var(--success)' : 'var(--danger)'};">
                                <i class="fas fa-${habit.completed ? 'check-circle' : 'times-circle'}"></i>
                            </div>
                            <span>${habit.name}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // Helper function to get today's date string in YYYY-MM-DD format
        function getTodayDateString() {
            return getDateString(new Date());
        }
        
        // Helper function to get date string in YYYY-MM-DD format
        function getDateString(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // Save habits to localStorage
        function saveHabits() {
            localStorage.setItem('habits', JSON.stringify(habits));
        }
        
        // Initialize with a few example habits if empty
        if (habits.length === 0) {
            // Add example habits for today
            const today = getTodayDateString();
            
            // Add example habits for yesterday
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = getDateString(yesterday);
            
            const exampleHabits = [
                { id: 1, name: "Morning meditation for 10 mins", completed: true, date: today, createdAt: new Date().toISOString() },
                { id: 2, name: "Drink 8 glasses of water", completed: false, date: today, createdAt: new Date().toISOString() },
                { id: 3, name: "Read for 30 minutes", completed: true, date: today, createdAt: new Date().toISOString() },
                { id: 4, name: "Exercise for 30 minutes", completed: true, date: yesterdayStr, createdAt: new Date().toISOString() },
                { id: 5, name: "Journal for 10 minutes", completed: false, date: yesterdayStr, createdAt: new Date().toISOString() },
                { id: 6, name: "Plan next day", completed: true, date: yesterdayStr, createdAt: new Date().toISOString() }
            ];
            
            habits = exampleHabits;
            saveHabits();
            renderTodayHabits();
            renderAllHabits();
            updateStats();
            generateCalendar(currentMonth, currentYearCalendar);
            renderSelectedDateHabits(new Date());
            renderWeeklyProgress();
            renderYesterdaySummary();
        }
    </script>
</body>
</html>
